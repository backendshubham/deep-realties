<%- include('../layouts/main', { content: `
<!-- Hero Section -->
<section class="relative bg-gradient-to-br from-emerald-600 via-emerald-700 to-teal-600 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 text-white py-20 lg:py-32">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <span class="inline-block px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full mb-6 text-sm font-medium">
            Events & Exhibitions
        </span>
        <h1 class="text-5xl md:text-6xl lg:text-7xl font-display font-bold mb-6">
            Join Our Real Estate Events
        </h1>
        <p class="text-xl md:text-2xl text-emerald-100 dark:text-gray-300 max-w-3xl mx-auto">
            Connect with builders, dealers, and industry experts at our exclusive meetups and inaugurations
        </p>
    </div>
</section>

<!-- Events Section -->
<section class="py-20 bg-white dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Tabs -->
        <div class="flex border-b border-gray-200 dark:border-gray-700 mb-8">
            <button onclick="switchTab('upcoming')" id="upcomingTab" class="px-6 py-3 font-semibold text-emerald-600 dark:text-emerald-400 border-b-2 border-emerald-600 dark:border-emerald-400 transition-colors">
                Upcoming Events
            </button>
            <button onclick="switchTab('past')" id="pastTab" class="px-6 py-3 font-semibold text-gray-600 dark:text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors">
                Past Events
            </button>
        </div>

        <!-- Events List -->
        <div id="loadingState" class="text-center py-12">
            <div class="inline-loader-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">Loading events...</p>
        </div>

        <div id="emptyState" class="hidden text-center py-12">
            <p class="text-gray-600 dark:text-gray-400 text-lg">No events found</p>
        </div>

        <div id="eventsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>
</section>

<script>
    let currentTab = 'upcoming';

    document.addEventListener('DOMContentLoaded', function() {
        loadEvents('upcoming');
    });

    function switchTab(tab) {
        currentTab = tab;
        
        // Update tab styles
        const upcomingTab = document.getElementById('upcomingTab');
        const pastTab = document.getElementById('pastTab');
        
        if (tab === 'upcoming') {
            upcomingTab.classList.add('text-emerald-600', 'dark:text-emerald-400', 'border-b-2', 'border-emerald-600', 'dark:border-emerald-400');
            upcomingTab.classList.remove('text-gray-600', 'dark:text-gray-400');
            pastTab.classList.remove('text-emerald-600', 'dark:text-emerald-400', 'border-b-2', 'border-emerald-600', 'dark:border-emerald-400');
            pastTab.classList.add('text-gray-600', 'dark:text-gray-400');
        } else {
            pastTab.classList.add('text-emerald-600', 'dark:text-emerald-400', 'border-b-2', 'border-emerald-600', 'dark:border-emerald-400');
            pastTab.classList.remove('text-gray-600', 'dark:text-gray-400');
            upcomingTab.classList.remove('text-emerald-600', 'dark:text-emerald-400', 'border-b-2', 'border-emerald-600', 'dark:border-emerald-400');
            upcomingTab.classList.add('text-gray-600', 'dark:text-gray-400');
        }
        
        loadEvents(tab);
    }

    async function loadEvents(type) {
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const eventsList = document.getElementById('eventsList');

        loadingState.classList.remove('hidden');
        emptyState.classList.add('hidden');
        eventsList.classList.add('hidden');

        try {
            const params = new URLSearchParams({
                is_past: type === 'past' ? 'true' : 'false',
                limit: '50'
            });

            const response = await fetch('/api/events?' + params.toString());
            const data = await response.json();
            const events = data.events || [];

            loadingState.classList.add('hidden');

            if (events.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            eventsList.classList.remove('hidden');
            
            const eventTypeLabels = {
                'builder_meetup': 'Builder Meetup',
                'dealer_meetup': 'Dealer Meetup',
                'inauguration': 'Inauguration'
            };

            eventsList.innerHTML = events.map(event => {
                const eventDate = new Date(event.event_date).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                const eventTime = event.event_time || '';
                const eventImage = event.banner_image || (event.images && event.images[0]) || '/images/placeholder.jpg';
                const description = event.description ? (event.description.length > 150 ? event.description.substring(0, 150) + '...' : event.description) : '';

                return '<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow">' +
                    '<div class="relative h-48 bg-gray-200 dark:bg-gray-700">' +
                        '<img src="' + eventImage + '" alt="' + (event.title || 'Event') + '" class="w-full h-full object-cover" onerror="this.src=\'/images/placeholder.jpg\'">' +
                        '<span class="absolute top-3 right-3 px-3 py-1 bg-emerald-600 text-white text-xs font-semibold rounded-full">' +
                            (eventTypeLabels[event.event_type] || event.event_type) +
                        '</span>' +
                    '</div>' +
                    '<div class="p-6">' +
                        '<h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">' + (event.title || 'Untitled Event') + '</h3>' +
                        (description ? '<p class="text-gray-600 dark:text-gray-400 text-sm mb-4">' + description + '</p>' : '') +
                        '<div class="space-y-2 mb-4">' +
                            '<div class="flex items-center text-sm text-gray-600 dark:text-gray-400">' +
                                '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>' +
                                '</svg>' +
                                eventDate + (eventTime ? ' at ' + eventTime : '') +
                            '</div>' +
                            '<div class="flex items-center text-sm text-gray-600 dark:text-gray-400">' +
                                '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>' +
                                '</svg>' +
                                (event.location || '') + ', ' + (event.city || '') +
                            '</div>' +
                        '</div>' +
                        '<div class="flex gap-3">' +
                            (event.registration_link ? 
                                '<a href="' + event.registration_link + '" target="_blank" class="flex-1 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-center font-semibold transition-colors">Register Now</a>' :
                                '<button onclick="registerForEvent(\'' + event.id + '\')" class="flex-1 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-semibold transition-colors">Register Now</button>'
                            ) +
                            '<button onclick="viewEventDetails(\'' + event.id + '\')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg transition-colors">Details</button>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }).join('');

        } catch (error) {
            console.error('Error loading events:', error);
            loadingState.classList.add('hidden');
            emptyState.classList.remove('hidden');
            if (typeof window.showError === 'function') {
                window.showError('Failed to load events. Please try again.');
            }
        }
    }

    function viewEventDetails(eventId) {
        // Show event details in modal
        fetch('/api/events/' + eventId)
            .then(res => res.json())
            .then(data => {
                const event = data.event;
                const eventDate = new Date(event.event_date).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                let content = '<div class="space-y-4">' +
                    '<h2 class="text-2xl font-bold text-gray-900 dark:text-white">' + (event.title || 'Event') + '</h2>' +
                    '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">' +
                        '<div><strong>Date:</strong> ' + eventDate + (event.event_time ? ' at ' + event.event_time : '') + '</div>' +
                        '<div><strong>Location:</strong> ' + (event.location || '') + ', ' + (event.city || '') + '</div>' +
                    '</div>';
                
                if (event.description) {
                    content += '<p class="text-gray-600 dark:text-gray-400">' + event.description + '</p>';
                }
                
                if (event.agenda) {
                    content += '<div><strong class="text-gray-900 dark:text-white">Agenda:</strong><div class="mt-2 text-gray-600 dark:text-gray-400 whitespace-pre-line">' + event.agenda + '</div></div>';
                }
                
                if (event.contact_person || event.contact_email || event.contact_phone) {
                    content += '<div><strong class="text-gray-900 dark:text-white">Contact:</strong><div class="mt-2 text-gray-600 dark:text-gray-400">';
                    if (event.contact_person) content += event.contact_person + '<br>';
                    if (event.contact_email) content += event.contact_email + '<br>';
                    if (event.contact_phone) content += event.contact_phone;
                    content += '</div></div>';
                }
                
                if (event.rsvp_info) {
                    content += '<div><strong class="text-gray-900 dark:text-white">RSVP:</strong><div class="mt-2 text-gray-600 dark:text-gray-400">' + event.rsvp_info + '</div></div>';
                }
                
                content += '</div>';
                
                if (typeof window.showModal === 'function') {
                    window.showModal('Event Details', content);
                }
            })
            .catch(error => {
                console.error('Error loading event details:', error);
                if (typeof window.showError === 'function') {
                    window.showError('Failed to load event details.');
                }
            });
    }

    function registerForEvent(eventId) {
        if (typeof window.showModal === 'function') {
            const formHTML = '<form id="registrationForm" onsubmit="submitRegistration(event, \'' + eventId + '\')" class="space-y-4">' +
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name *</label>' +
                    '<input type="text" id="regName" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">' +
                '</div>' +
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email *</label>' +
                    '<input type="email" id="regEmail" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">' +
                '</div>' +
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone *</label>' +
                    '<input type="tel" id="regPhone" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">' +
                '</div>' +
                '<button type="submit" class="w-full px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-semibold transition-colors">Submit Registration</button>' +
            '</form>';
            
            window.showModal('Event Registration', formHTML);
        }
    }

    function submitRegistration(e, eventId) {
        e.preventDefault();
        const name = document.getElementById('regName').value;
        const email = document.getElementById('regEmail').value;
        const phone = document.getElementById('regPhone').value;

        fetch('/api/events/' + eventId + '/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ full_name: name, email, phone })
        })
        .then(res => res.json())
        .then(data => {
            if (data.message) {
                if (typeof window.showSuccess === 'function') {
                    window.showSuccess('Successfully registered for the event!');
                }
                if (typeof window.closeModal === 'function') {
                    window.closeModal();
                }
            } else {
                if (typeof window.showError === 'function') {
                    window.showError(data.error || 'Registration failed');
                }
            }
        })
        .catch(error => {
            console.error('Registration error:', error);
            if (typeof window.showError === 'function') {
                window.showError('Registration failed. Please try again.');
            }
        });
    }
</script>
` }) %>
